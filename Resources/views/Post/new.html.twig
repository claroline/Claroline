{% extends 'IcapBlogBundle::layout.html.twig' %}

{% form_theme form _self %}

{% block form_row %}
    {% spaceless %}
        <div class="form-group{% if errors|length > 0 %} has-error{% endif %}">
            {{ form_label(form, label|default(null)) }}
            {% set ctrl_width = theme_options.control_width is defined ? theme_options.control_width : 'col-md-10' %}
            <div class="{{ ctrl_width }}">
                {{ form_errors(form) }}
                {% if help is defined and help %}
                    <div class="help-block">{{ help }}</div>
                {% endif %}
                {{ form_widget(form) }}
            </div>
        </div>
    {% endspaceless %}
{% endblock form_row %}

{% block title %}{{ _resource.resourceNode.getName() }} - {{ "add_new_post"|trans({}, 'icap_blog') }}{% endblock %}

{% block blog_content %}
    <form action="{{ _path('icap_blog_post_new', {'blogId':_resource.getId()}) }}" method="post" {{ form_enctype(form) }} class="well" id="new_post_form" novalidate>
        <legend>{{ "add_new_post"|trans({}, 'icap_blog') }}</legend>
        {% if false ==_resource.isAutoPublishPost %}
        <p class="alert alert-warning">
            {{ 'icap_blog_post_need_validation_before_publishing'|trans({}, 'icap_blog') }}
        </p>
        {% endif %}
        {{ form_widget(form) }}
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">{{ 'add'|trans({}, 'platform') }}</button>
            <a href="{{ path("icap_blog_view", {"blogId": _resource.id}) }}" title="{{ 'cancel'|trans({}, 'platform') }}" class="btn btn-danger">{{ 'cancel'|trans({}, 'platform') }}</a>
        </div>
    </form>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel='stylesheet' type='text/css' href='{{ asset('bundles/clarolinecore/css/common/jquery-ui-bootstrap/jquery-ui-1.9.2.custom.css') }}'/>
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/frontend/jquery/plugin/tag-it/css/jquery.tagit.css') }}"/>
{% endblock %}

{% block javascripts %}
{{ parent() }}
{% render controller('ClarolineCoreBundle:Tool\\WorkspaceResourceParameters:initPicker') %}
{{ tinymce_init() }}
<script type="text/javascript" src="{{ asset('bundles/frontend/jquery/jquery-ui-1.9.2/jquery-ui-1.9.2.js') }}"></script>
<script type="text/javascript" src="{{ asset('bundles/frontend/jquery/plugin/tag-it/js/tag-it.min.js') }}"></script>
<script type="text/javascript">
    $(function() {
        $(".tags").tagit({
            'availableTags' : ["{{ blog_tags(_resource)|join('","')|raw }}"]
        });
    });
</script>
{% endblock %}
