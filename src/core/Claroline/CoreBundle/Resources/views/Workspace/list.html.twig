{% macro showTag(tagsList, tagWorkspaces, hierarchy, index, displayable) %}
{% import _self as listMacros %}
{% for tag in tagsList %}
    {% set workspaceTagId = tag.getId() %}
    {% if displayable[workspaceTagId] %}
    {% set currentIndex = index ~ "-" ~ workspaceTagId %}
    <div class="accordion-group">
        <div class="accordion-heading">
            <a  class="accordion-toggle"
                data-toggle="collapse"
                href="#collapse-{{ currentIndex }}"
            >
                <i class="icon-align-justify"></i>
                {{ tag.getName() }}
                <i class="icon-chevron-down pull-right"></i>
            </a>
        </div>
        <div id="collapse-{{ currentIndex }}" class="accordion-body collapse">
            <div class="accordion-inner">
                {% if hierarchy[workspaceTagId]|length > 0 %}
                {{ _self.showTag(hierarchy[workspaceTagId], tagWorkspaces, hierarchy, currentIndex, displayable) }}
                {% endif %}

                {% if tagWorkspaces[workspaceTagId] is defined %}
                {% set relations = tagWorkspaces[workspaceTagId] %}
                <div id="workspace-list-pager-{{ currentIndex }}" class="workspace-list-pager">
                    {% include 'ClarolineCoreBundle:Workspace:workspaceListByTagPager.html.twig' %}
                </div>
                {% endif %}

            </div>
        </div>
    </div>
    {% endif %}
{% endfor %}
{% endmacro %}

{% from _self import showTag %}

{% extends 'ClarolineCoreBundle:WorkspaceTag:layout.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script
        src="{{ asset('bundles/clarolinecore/js/workspace/workspace_list.js') }}"
        type="text/javascript"
    >
    </script>
{% endblock %}

{% block section_content %}

    {{
        macros.breadcrumbs([
            {
                'icon': 'icon-book',
                'name': 'all_workspaces'|trans({}, 'platform'),
                'href': '#'
            }
        ])
    }}

    <div id="workspace-list-div" class="margin widget">

    {% if is_granted('ROLE_ADMIN') %}
        <a href="{{ path('claro_workspace_manage_admin_tag') }}">
            <button type="button" class="btn">{{ 'admin_tags_management'|trans({}, 'platform') }}</button>
        </a>
        <hr>
    {% endif %}

    <div class="accordion" id="accordion-all">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a  class="accordion-toggle"
                    data-toggle="collapse"
                    data-parent="#accordion-all"
                    href="#collapse-all"
                >
                    <i class="icon-align-justify"></i>
                    {{ 'all_workspaces'|trans({}, 'platform') }}
                    <i class="icon-chevron-down pull-right"></i>
                </a>
            </div>
            <div id="collapse-all" class="accordion-body collapse {% if tags|length == 0 %}in{% endif %}">
                <div class="accordion-inner">
                    <div id="workspace-list-pager-all" class="workspace-list-pager">
                        {% include 'ClarolineCoreBundle:Workspace:workspaceCompleteListPager.html.twig' %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {{ showTag(rootTags, tagWorkspaces, hierarchy, "0", displayable) }}
    </div>
{% endblock %}
