{% extends 'ClarolineCoreBundle:WorkspaceTag:layout.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script src='{{ asset('bundles/clarolinecore/js/workspace/workspace_tag.js') }}' type="text/javascript"></script>
{% endblock %}

{% block section_content %}

    {{
        macros.breadcrumbs([
            {
                'icon': 'icon-book',
                'name': 'my_workspaces'|trans({}, 'platform'),
                'href': path('claro_workspace_by_user', {'userId': user.getId()})
            },
            {
                'name': 'tags_management'|trans({}, 'platform'),
                'href': ''
            }
        ])
    }}

    <div class="margin">
        <a href="{{ path('claro_workspace_tag_create_form') }}">
            <button type="button" class="btn">{{ 'create_new_tag'|trans({}, 'platform') }}</button>
        </a>
        <a href="{{ path('claro_workspace_organize_tag') }}">
            <button type="button" class="btn">{{ 'organize_private_tags'|trans({}, 'platform') }}</button>
        </a>

        <hr>

        <table id="manage-tag-table" class="table table-striped table-bordered table-condensed">
            <thead>
                <th> {{ 'workspace'|trans({}, 'platform') }} </th>
                <th> {{ 'tag'|trans({}, 'platform') }} </th>
            </thead>
            <tbody id="manage-tag-table-body">
                {% for workspace in workspaces %}
                    <tr>
                        <td>
                            {{ workspace.getName() }}
                            <small><em>({{ workspace.getCode() }})</em></small>
                        </td>
                        <td>
                            {% for workspaceTag in workspacesTags[workspace.getId()] %}
                                <span class="label
                                    {% if workspaceTag.getTag().getUser() is not null %}
                                        label-success
                                    {% else %}
                                        label-important
                                    {% endif %}
                                ">
                                    {{ workspaceTag.getTag().getName() }}
                                    {% if workspaceTag.getTag().getUser() is not null %}
                                        <i  class="icon-remove-sign remove-tag-button"
                                            data-workspace-id="{{ workspace.getId() }}"
                                            data-tag-id="{{ workspaceTag.getTag().getId() }}"
                                        >
                                        </i>
                                    {% endif %}
                                </span>
                            {% endfor %}
                            <i  class="icon-plus-sign add-tag-button"
                                data-trigger="hover"
                                data-placement="top"
                                data-content="{{ 'add_tag_to_workspace'|trans({}, 'platform') }}"
                                data-workspace-id="{{ workspace.getId() }}"
                            >
                            </i>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="twig-add-tag-user-id" data-user-id="{{ user.getId() }}">
    </div>

    <div id="add-tag-validation-box" class="modal hide fade">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">Ã—</button>
            <h3>{{ 'enter_tag_name_message'|trans({}, 'platform') }}</h3>
        </div>
        <div class="modal-body" style="overflow-y: visible">
            <label for="modal-tag-input">{{ 'name'|trans({}, 'platform') }} : </label>
            <input
                id='modal-tag-input'
                type='text'
                name='tag-to-add'
                data-provide='typeahead'
                data-source='{{ tagsNameTxt }}'
                autocomplete='off'>
        </div>
        <div class="modal-footer">
            <input type="button" id="add-tag-confirm-ok" class="btn btn-primary" value="{{ 'ok'|trans({}, 'platform') }}"/>
            <input type="button" class="btn btn-secondary" data-dismiss="modal" value="{{ 'cancel'|trans({}, 'platform') }}"/>
        </div>
    </div>
{% endblock %}
